<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>Mich Cotizador âœ¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            coral: { 50:'#FFF1F0',100:'#FFE0DE',200:'#FFC2BD',300:'#FF9D96',400:'#E8716D',500:'#D4605C',600:'#B5423E',700:'#8C302D' },
            navy: { 50:'#E8EDF5',100:'#C5D0E6',400:'#4A6291',500:'#2C4570',600:'#1B2A4A',700:'#111D33' },
            cream: { 50:'#FFFDF9',100:'#FFF8F0',200:'#FFF0E0',300:'#FFE8CC' }
          },
          fontFamily: { poppins:['Poppins','sans-serif'] }
        }
      }
    }
  </script>
  <style>
    *{font-family:'Poppins',sans-serif}

    /* â”€â”€ Refined Inputs â”€â”€ */
    .fi-label{display:block;font-size:12px;font-weight:600;color:#1B2A4A;margin-bottom:4px;letter-spacing:0.02em}
    .fi-input{width:100%;padding:14px 16px;background:#FFF8F0;border:1.5px solid #FFE8CC;border-radius:14px;font-size:14px;color:#1B2A4A;outline:none;transition:all .2s}
    .fi-input:focus{border-color:#E8716D;background:#fff;box-shadow:0 0 0 3px rgba(232,113,109,0.1)}
    .fi-input::placeholder{color:#c4b5a5}
    .fi-select{width:100%;padding:14px 40px 14px 16px;background:#FFF8F0;border:1.5px solid #FFE8CC;border-radius:14px;font-size:14px;color:#1B2A4A;outline:none;transition:all .2s;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23c4b5a5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:20px}
    .fi-select:focus{border-color:#E8716D;background:#fff;box-shadow:0 0 0 3px rgba(232,113,109,0.1)}
    textarea.fi-input{resize:vertical;min-height:60px}

    /* â”€â”€ Toggle Switch â”€â”€ */
    .toggle-wrap{display:flex;align-items:center;gap:12px;padding:12px 16px;background:#FFF8F0;border-radius:14px;border:1.5px solid #FFE8CC;cursor:pointer;transition:all .2s;user-select:none}
    .toggle-wrap:has(input:checked){background:#FFF1F0;border-color:#FFC2BD}
    .toggle-track{position:relative;width:44px;height:26px;background:#ddd;border-radius:13px;transition:background .2s;flex-shrink:0}
    .toggle-track::after{content:'';position:absolute;top:3px;left:3px;width:20px;height:20px;background:#fff;border-radius:50%;transition:transform .2s;box-shadow:0 1px 3px rgba(0,0,0,.15)}
    .toggle-wrap input:checked+.toggle-track{background:#E8716D}
    .toggle-wrap input:checked+.toggle-track::after{transform:translateX(18px)}
    .toggle-wrap input{position:absolute;opacity:0;pointer-events:none}
    .toggle-text{font-size:13px;color:#1B2A4A;font-weight:500}

    /* â”€â”€ Section Cards â”€â”€ */
    .s-card{background:#fff;border-radius:20px;padding:24px;box-shadow:0 2px 12px rgba(27,42,74,0.04);border:1px solid rgba(255,232,204,0.5);margin-bottom:16px}
    .s-card h2{font-size:14px;font-weight:700;color:#1B2A4A;margin-bottom:16px;display:flex;align-items:center;gap:8px}

    /* â”€â”€ Destination sections â”€â”€ */
    .dest-section{display:none}.dest-section.active{display:block}

    /* â”€â”€ Buttons â”€â”€ */
    .btn-generate{width:100%;padding:18px;border-radius:18px;font-weight:700;color:#fff;font-size:17px;transition:all .2s;background:linear-gradient(135deg,#E8716D 0%,#D4605C 100%);box-shadow:0 4px 15px rgba(232,113,109,0.3);border:none;cursor:pointer}
    .btn-generate:hover{box-shadow:0 8px 30px rgba(232,113,109,0.45);transform:translateY(-1px)}
    .btn-generate:active{transform:scale(0.98)}
    .btn-action{width:100%;padding:14px;border-radius:14px;font-weight:600;font-size:13px;transition:all .15s;border:2px solid #E8716D;color:#E8716D;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
    .btn-action:hover{background:#FFF1F0}
    .btn-action:active{transform:scale(0.98)}
    .btn-link{font-size:13px;font-weight:600;color:#E8716D;background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:4px;padding:8px 0}
    .btn-link:hover{color:#D4605C}

    /* â”€â”€ Tabs â”€â”€ */
    .tab-bar{display:flex;gap:6px;background:#FFF8F0;border-radius:14px;padding:4px}
    .tab-btn{flex:1;padding:10px;border-radius:11px;font-size:13px;font-weight:600;text-align:center;transition:all .2s;cursor:pointer;border:none;color:#999}
    .tab-btn.active{background:#1B2A4A;color:#fff;box-shadow:0 2px 8px rgba(27,42,74,0.2)}

    /* â”€â”€ WhatsApp Preview â”€â”€ */
    .wa-bubble{background:#fff;border-radius:0 12px 12px 12px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,0.08);font-size:14px;line-height:1.7;color:#111;white-space:pre-wrap;word-wrap:break-word;outline:none;min-height:200px;max-width:90%}
    .wa-bubble b{font-weight:700}

    /* â”€â”€ Hotel preview â”€â”€ */
    .hotel-preview{margin-top:8px;border-radius:14px;overflow:hidden;transition:all .2s}
    .hotel-preview img{width:100%;height:120px;object-fit:cover;display:block}
    .hotel-cat{display:inline-block;padding:3px 10px;border-radius:20px;color:#fff;font-size:11px;font-weight:600}
    .cat-value{background:#22c55e}.cat-moderate{background:#3b82f6}.cat-deluxe{background:#a855f7}.cat-premier{background:#f59e0b}.cat-preferred{background:#6366f1}.cat-prime{background:#14b8a6}.cat-disney{background:#e11d48}.cat-onsite{background:#0ea5e9}

    /* â”€â”€ Card â”€â”€ */
    #card-render{width:420px;font-family:'Poppins',sans-serif}
    .card-editable{outline:none;border-bottom:1px dashed rgba(255,255,255,0.3);min-width:40px;display:inline-block}
    .card-editable:focus{border-bottom-color:rgba(255,255,255,0.8);background:rgba(255,255,255,0.05)}
    .card-editable-dark{outline:none;border-bottom:1px dashed rgba(0,0,0,0.15);min-width:40px;display:inline-block}
    .card-editable-dark:focus{border-bottom-color:rgba(0,0,0,0.4);background:rgba(0,0,0,0.02)}

    /* â”€â”€ Itinerary rows â”€â”€ */
    .it-row{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .price-group-card{background:#FFF8F0;border-radius:14px;padding:16px;margin-bottom:12px;border:1.5px solid #FFE8CC}

    /* â”€â”€ Toast â”€â”€ */
    .toast{position:fixed;top:16px;left:50%;transform:translateX(-50%);background:#1B2A4A;color:#fff;padding:12px 24px;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.15);font-size:13px;font-weight:600;z-index:50;transition:all .3s}

    @media(max-width:640px){
      #card-render{width:340px}
      .s-card{padding:20px;border-radius:16px}
    }
  </style>
</head>
<body class="bg-cream-100 min-h-screen">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header style="background:linear-gradient(135deg,#E8716D 0%,#D4605C 100%)" class="text-white py-5 px-5 shadow-lg sticky top-0 z-40">
  <div class="max-w-2xl mx-auto flex items-center justify-between">
    <div>
      <h1 class="text-xl font-extrabold tracking-tight leading-tight">Mich Cotizador âœ¨</h1>
      <p class="text-[11px] opacity-80 font-light mt-0.5">Generador de cotizaciones personalizadas</p>
    </div>
    <div class="w-11 h-11 bg-white/20 rounded-2xl flex items-center justify-center text-xl backdrop-blur-sm">ğŸ°</div>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="max-w-2xl mx-auto px-4 py-6 pb-32">

  <!-- Destination Selector -->
  <div class="s-card">
    <label class="fi-label">âœˆï¸ Destino</label>
    <select id="destino" class="fi-select text-base font-semibold" onchange="onDestinoChange()">
      <option value="">â€” Selecciona un destino â€”</option>
      <option value="orlando">ğŸ° Disney World Â· Orlando</option>
      <option value="universal">ğŸ¢ Universal Studios Â· Orlando</option>
      <option value="california">ğŸ¡ Disneyland Â· California</option>
      <option value="paris">ğŸ—¼ Disneyland Â· Paris</option>
      <option value="crucero-disney">ğŸš¢ Crucero Disney</option>
      <option value="crucero-otros">ğŸ›³ Crucero Otras Navieras</option>
      <option value="nickelodeon">ğŸ§½ Nickelodeon Resort</option>
      <option value="xcaret">ğŸŒ´ Xcaret</option>
    </select>
    <div id="dest-image-preview" class="mt-3 rounded-2xl overflow-hidden" style="display:none">
      <img id="dest-image" src="" alt="" style="width:100%;height:150px;object-fit:cover" onerror="this.parentElement.style.display='none'">
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="form-container" style="display:none">

    <!-- Client -->
    <div class="s-card">
      <h2>ğŸ‘¤ Datos del cliente</h2>
      <input id="nombre" type="text" placeholder="Nombre del cliente" class="fi-input">
    </div>

    <!-- Travelers -->
    <div class="s-card">
      <h2>ğŸ‘¥ Viajeros</h2>
      <div class="grid grid-cols-2 gap-3 mb-4">
        <div><label class="fi-label">Adultos</label><input id="adultos" type="number" min="1" value="2" class="fi-input"></div>
        <div><label class="fi-label" id="label-habitaciones">Habitaciones</label><input id="habitaciones" type="number" min="1" value="1" class="fi-input"></div>
      </div>
      <p class="text-[11px] font-semibold text-gray-400 mb-2 uppercase tracking-wide">Menores de edad</p>
      <div class="grid grid-cols-3 gap-3">
        <div><label class="text-[11px] text-gray-400">0-2 aÃ±os</label><input id="menores02" type="number" min="0" value="0" class="fi-input"></div>
        <div><label class="text-[11px] text-gray-400">3-9 aÃ±os</label><input id="menores39" type="number" min="0" value="0" class="fi-input"></div>
        <div><label class="text-[11px] text-gray-400">10-17 aÃ±os</label><input id="menores1017" type="number" min="0" value="0" class="fi-input"></div>
      </div>
    </div>

    <!-- Dates -->
    <div class="s-card">
      <h2>ğŸ“… Fechas</h2>
      <div class="grid grid-cols-2 gap-3">
        <div><label class="fi-label" id="label-checkin">Check in</label><input id="checkin" type="date" class="fi-input"></div>
        <div><label class="fi-label" id="label-checkout">Check out</label><input id="checkout" type="date" class="fi-input"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• DISNEY WORLD ORLANDO â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="campos-orlando" class="dest-section">
      <div class="s-card">
        <h2>ğŸ° Detalles Disney World</h2>
        <label class="fi-label">Hotel / Hospedaje</label>
        <select id="orl-hotel" class="fi-select mb-2" onchange="showHotelPreview('orl')">
          <option value="">â€” Selecciona un hotel â€”</option>
          <optgroup label="â­ Value Resorts">
            <option>Disney's All-Star Movies Resort</option>
            <option>Disney's All-Star Music Resort</option>
            <option>Disney's All-Star Sports Resort</option>
            <option>Disney's Art of Animation Resort</option>
            <option>Disney's Pop Century Resort</option>
          </optgroup>
          <optgroup label="â­â­ Moderate Resorts">
            <option>Disney's Caribbean Beach Resort</option>
            <option>Disney's Coronado Springs Resort</option>
            <option>Disney's Port Orleans - French Quarter</option>
            <option>Disney's Port Orleans - Riverside</option>
            <option>Disney's Fort Wilderness Cabins</option>
          </optgroup>
          <optgroup label="â­â­â­ Deluxe Resorts">
            <option>Disney's Grand Floridian Resort &amp; Spa</option>
            <option>Disney's Contemporary Resort</option>
            <option>Disney's Polynesian Village Resort</option>
            <option>Disney's Animal Kingdom Lodge</option>
            <option>Disney's Wilderness Lodge</option>
            <option>Disney's BoardWalk Inn</option>
            <option>Disney's Beach Club Resort</option>
            <option>Disney's Yacht Club Resort</option>
            <option>Disney's Riviera Resort</option>
          </optgroup>
          <optgroup label="ğŸ¨ Otros">
            <option>Walt Disney World Swan</option>
            <option>Walt Disney World Dolphin</option>
            <option>Four Seasons Resort Orlando</option>
          </optgroup>
        </select>
        <div id="orl-hotel-preview" class="hotel-preview"></div>

        <div class="grid grid-cols-2 gap-3 my-4">
          <div>
            <label class="fi-label">Tipo de entrada</label>
            <select id="orl-modalidad" class="fi-select">
              <option>Base Ticket (1 parque x dÃ­a)</option>
              <option>Park Hopper</option>
              <option>Park Hopper Plus</option>
            </select>
          </div>
          <div><label class="fi-label">DÃ­as de entradas</label><input id="orl-dias" type="number" min="1" value="4" class="fi-input"></div>
        </div>

        <!-- Dining Plan - Updated 2026 -->
        <label class="fi-label mb-2">ğŸ½ Plan de comidas</label>
        <select id="orl-comidas" class="fi-select mb-2" onchange="toggleComidaDetail()">
          <option value="">Sin plan de comidas</option>
          <option value="quick">Quick-Service ($60.50 USD/adulto/noche)</option>
          <option value="standard">Standard - Mesa ($98.50 USD/adulto/noche)</option>
        </select>
        <div id="orl-comidas-detail" style="display:none" class="bg-cream-100 rounded-xl p-3 mb-3 text-xs text-gray-600">
          <div id="orl-comidas-info"></div>
        </div>

        <label class="toggle-wrap mb-3" for="orl-kidsfree">
          <input type="checkbox" id="orl-kidsfree">
          <div class="toggle-track"></div>
          <span class="toggle-text">ğŸ‰ Kids Eat Free 2026 (niÃ±os 3-9 con plan de adulto)</span>
        </label>

        <label class="toggle-wrap" for="orl-memory">
          <input type="checkbox" id="orl-memory">
          <div class="toggle-track"></div>
          <span class="toggle-text">ğŸ“¸ Ofrecer Memory Maker ($185 USD)</span>
        </label>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• UNIVERSAL STUDIOS ORLANDO - Updated 2026 â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="campos-universal" class="dest-section">
      <div class="s-card">
        <h2>ğŸ¢ Detalles Universal Studios</h2>
        <label class="fi-label">Hotel / Hospedaje</label>
        <select id="uni-hotel" class="fi-select mb-2" onchange="showHotelPreview('uni')">
          <option value="">â€” Selecciona un hotel â€”</option>
          <optgroup label="â­ Value">
            <option>Universal's Endless Summer - Surfside Inn</option>
            <option>Universal's Endless Summer - Dockside Inn</option>
          </optgroup>
          <optgroup label="â­â­ Prime Value">
            <option>Universal's Cabana Bay Beach Resort</option>
            <option>Universal's Aventura Hotel</option>
            <option>Universal Stella Nova Resort</option>
            <option>Universal Terra Luna Resort</option>
          </optgroup>
          <optgroup label="â­â­â­ Preferred">
            <option>Loews Sapphire Falls Resort</option>
            <option>Loews Royal Pacific Resort</option>
            <option>Hard Rock Hotel Orlando</option>
            <option>Loews Portofino Bay Hotel</option>
            <option>Universal's Grand Helios Hotel</option>
          </optgroup>
        </select>
        <div id="uni-hotel-preview" class="hotel-preview"></div>

        <div class="grid grid-cols-2 gap-3 my-4">
          <div>
            <label class="fi-label">Tipo de ticket (2026)</label>
            <select id="uni-modalidad" class="fi-select" onchange="updateUniDesc()">
              <option value="3base">3-Day Base (1 parque/dÃ­a)</option>
              <option value="3ptp" selected>3-Day Park-to-Park</option>
              <option value="4ptp">4-Day Park-to-Park</option>
              <option value="5ptp">5-Day Park-to-Park</option>
            </select>
          </div>
          <div><label class="fi-label">DÃ­as</label><input id="uni-dias" type="number" min="3" value="3" class="fi-input"></div>
        </div>
        <div id="uni-desc" class="bg-cream-100 rounded-xl p-3 mb-3 text-xs text-gray-600"></div>

        <label class="toggle-wrap" for="uni-volcano">
          <input type="checkbox" id="uni-volcano">
          <div class="toggle-track"></div>
          <span class="toggle-text">ğŸŒ‹ Agregar Volcano Bay</span>
        </label>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• DISNEYLAND CALIFORNIA - Updated â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="campos-california" class="dest-section">
      <div class="s-card">
        <h2>ğŸ¡ Detalles Disneyland California</h2>
        <label class="fi-label">Hotel / Hospedaje</label>
        <select id="cal-hotel" class="fi-select mb-2" onchange="showHotelPreview('cal')">
          <option value="">â€” Selecciona un hotel â€”</option>
          <optgroup label="ğŸ° Hoteles Disney">
            <option>Disneyland Hotel</option>
            <option>Disney's Grand Californian Hotel &amp; Spa</option>
            <option>Pixar Place Hotel</option>
          </optgroup>
          <optgroup label="ğŸ¨ Good Neighbor Hotels">
            <option>JW Marriott Anaheim Resort</option>
            <option>Hyatt Regency Orange County</option>
            <option>Courtyard by Marriott Anaheim</option>
            <option>Howard Johnson by Wyndham Anaheim</option>
            <option>Best Western Plus Park Place Inn</option>
          </optgroup>
        </select>
        <div id="cal-hotel-preview" class="hotel-preview"></div>

        <div class="grid grid-cols-2 gap-3 my-4">
          <div>
            <label class="fi-label">Tipo de entrada</label>
            <select id="cal-ticket" class="fi-select">
              <option>1 parque por dÃ­a</option>
              <option>Park Hopper (ambos parques)</option>
            </select>
          </div>
          <div><label class="fi-label">DÃ­as de entradas</label><input id="cal-dias" type="number" min="1" value="2" class="fi-input"></div>
        </div>

        <label class="fi-label mb-2">âš¡ Lightning Lane (opcional)</label>
        <select id="cal-lightning" class="fi-select mb-3">
          <option value="">Sin Lightning Lane</option>
          <option value="multi">Lightning Lane Multi Pass (desde $34/dÃ­a)</option>
          <option value="single">Lightning Lane Single Pass (atracciones individuales)</option>
          <option value="premier">Lightning Lane Premier Pass (todas las atracciones)</option>
        </select>

        <label class="toggle-wrap" for="cal-starwars">
          <input type="checkbox" id="cal-starwars">
          <div class="toggle-track"></div>
          <span class="toggle-text">ğŸª Incluir nota Star Wars Nite</span>
        </label>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• DISNEYLAND PARIS â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="campos-paris" class="dest-section">
      <div class="s-card">
        <h2>ğŸ—¼ Detalles Disneyland Paris</h2>
        <label class="fi-label">Hotel / Hospedaje</label>
        <select id="par-hotel" class="fi-select mb-2" onchange="showHotelPreview('par')">
          <option value="">â€” Selecciona un hotel â€”</option>
          <optgroup label="â­â­â­ Deluxe"><option>Disneyland Hotel</option><option>Disney's Hotel New York â€“ The Art of Marvel</option></optgroup>
          <optgroup label="â­â­ Premium"><option>Disney Newport Bay Club</option><option>Disney Sequoia Lodge</option></optgroup>
          <optgroup label="â­ EstÃ¡ndar"><option>Disney Hotel Cheyenne</option><option>Disney Hotel Santa Fe</option></optgroup>
          <optgroup label="ğŸ• Otros"><option>Disney's Davy Crockett Ranch</option><option>Explorers Hotel</option></optgroup>
        </select>
        <div id="par-hotel-preview" class="hotel-preview"></div>
        <p class="text-[11px] text-gray-400 italic mt-3">* Entradas por toda la estancia y desayuno se agregan automÃ¡ticamente</p>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• CRUCERO DISNEY â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="campos-crucero-disney" class="dest-section">
      <div class="s-card">
        <h2>ğŸš¢ Detalles Crucero Disney</h2>
        <label class="fi-label">Barco</label>
        <select id="crd-barco" class="fi-select mb-2" onchange="showShipPreview()">
          <option>Disney Magic</option><option>Disney Wonder</option><option>Disney Dream</option>
          <option>Disney Fantasy</option><option>Disney Wish</option><option>Disney Treasure</option>
        </select>
        <div id="crd-ship-preview" class="hotel-preview mb-4"></div>
        <label class="fi-label">Itinerario</label>
        <div id="crd-itinerario-container" class="mb-2"></div>
        <button type="button" onclick="addItineraryDay('crd')" class="btn-link"><span class="text-lg leading-none">+</span> Agregar dÃ­a</button>
        <div class="grid grid-cols-2 gap-3 my-4">
          <div><label class="fi-label">Tipo de camarote</label>
            <select id="crd-camarote" class="fi-select"><option>Interior</option><option>Vista al mar</option><option>BalcÃ³n</option><option>Suite</option></select>
          </div>
          <div><label class="fi-label">Camarotes</label><input id="crd-camarotes" type="number" min="1" value="1" class="fi-input"></div>
        </div>
        <label class="fi-label">PromociÃ³n (opcional)</label>
        <input id="crd-promo" type="text" placeholder="Ej: 20% DE DESCUENTO + $250 USD DE CRÃ‰DITO" class="fi-input">
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• CRUCERO OTRAS NAVIERAS â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="campos-crucero-otros" class="dest-section">
      <div class="s-card">
        <h2>ğŸ›³ Detalles Crucero</h2>
        <label class="fi-label">Naviera / Barco</label>
        <input id="cro-barco" type="text" placeholder="Ej: Royal Caribbean - Icon of the Seas" class="fi-input mb-3">
        <label class="fi-label">Itinerario</label>
        <div id="cro-itinerario-container" class="mb-2"></div>
        <button type="button" onclick="addItineraryDay('cro')" class="btn-link"><span class="text-lg leading-none">+</span> Agregar dÃ­a</button>
        <label class="fi-label mt-4">Grupos de precios</label>
        <div id="cro-precios-container" class="mb-2"></div>
        <button type="button" onclick="addPriceGroup()" class="btn-link"><span class="text-lg leading-none">+</span> Agregar grupo de precios</button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• NICKELODEON â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="campos-nickelodeon" class="dest-section">
      <div class="s-card">
        <h2>ğŸ§½ Nickelodeon Resort</h2>
        <div class="bg-cream-100 rounded-xl p-4 text-sm text-gray-600">
          <p class="font-semibold text-navy-600 mb-1">ğŸ¨ Nickelodeon Resort Â· Riviera Maya</p>
          <p class="text-xs">âœ… TODO INCLUIDO Â· Las inclusiones se agregan automÃ¡ticamente</p>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• XCARET â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="campos-xcaret" class="dest-section">
      <div class="s-card">
        <h2>ğŸŒ´ Detalles Xcaret</h2>
        <label class="fi-label">Hotel</label>
        <select id="xca-hotel" class="fi-select mb-2" onchange="showHotelPreview('xca')">
          <option>Hotel Xcaret MÃ©xico</option><option>Hotel Xcaret Arte</option><option>La Casa de la Playa</option>
        </select>
        <div id="xca-hotel-preview" class="hotel-preview"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• PRICE â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="price-section" class="s-card">
      <h2>ğŸ’° Precio</h2>
      <label class="fi-label">Precio total USD</label>
      <div class="relative mb-3">
        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-coral-400 font-bold text-lg">$</span>
        <input id="precio" type="text" placeholder="2,717.38" class="fi-input pl-10 text-lg font-bold" style="letter-spacing:0.02em">
        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs font-semibold">USD</span>
      </div>
      <label class="fi-label">Notas adicionales (opcional)</label>
      <textarea id="notas" rows="2" placeholder="InformaciÃ³n extra..." class="fi-input"></textarea>
    </div>

    <!-- Generate -->
    <button onclick="generarMensaje()" class="btn-generate mb-8">âœ¨ Generar CotizaciÃ³n</button>

    <!-- â•â•â•â•â•â•â•â•â•â•â• PREVIEW â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="preview-section" style="display:none">
      <div class="tab-bar mb-4">
        <button onclick="switchTab('texto')" id="tab-texto" class="tab-btn active">ğŸ“‹ Texto</button>
        <button onclick="switchTab('tarjeta')" id="tab-tarjeta" class="tab-btn">ğŸ¨ Tarjeta</button>
      </div>

      <!-- Text Preview (WhatsApp style, editable) -->
      <div id="panel-texto">
        <div class="s-card !p-0 overflow-hidden">
          <div class="bg-[#ECE5DD] p-2.5">
            <p class="text-[11px] text-center text-gray-500 font-medium">Vista previa Â· Toca para editar</p>
          </div>
          <div class="bg-[#ECE5DD] px-3 pb-4">
            <div id="wa-preview" class="wa-bubble" contenteditable="true"></div>
          </div>
        </div>
        <p class="text-[11px] text-gray-400 text-center mt-2 mb-3">Edita directamente el texto antes de copiar</p>
        <button onclick="copiarTexto()" class="btn-action">ğŸ“‹ Copiar texto para WhatsApp</button>
      </div>

      <!-- Card Preview (editable) -->
      <div id="panel-tarjeta" style="display:none">
        <p class="text-[11px] text-gray-400 text-center mb-3">Toca los campos subrayados para editar antes de descargar</p>
        <div class="flex justify-center mb-4"><div id="card-wrapper" class="inline-block"><div id="card-render"></div></div></div>
        <button onclick="descargarImagen()" class="btn-action">ğŸ“· Descargar como imagen</button>
      </div>
    </div>

  </div><!-- /form-container -->
</main>

<div id="toast" class="toast opacity-0 pointer-events-none">Copiado âœ…</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- JAVASCRIPT -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€ CONFIG â”€â”€
const AGENT_TITLES={orlando:'Agente Disneyâœ¨',universal:'Agente Universalâœ¨',california:'Agente Disneyâœ¨',paris:'Agente Disneyâœ¨','crucero-disney':'Agente Disneyâœ¨','crucero-otros':'Agente de viajes',nickelodeon:'Agente de viajes',xcaret:'Agente de viajes'};

const CONDITIONS={
  orlando:'âœ… El paquete se aparta con $200 USD y el resto se puede ir pagando poco a poco hasta liquidarlo 1 mes antes de la fecha del check in. Cualquier modificaciÃ³n o cancelaciÃ³n al paquete se puede realizar antes de la fecha lÃ­mite de pago.',
  universal:'âœ… El paquete se aparta con $50 USD x persona y el resto se puede ir pagando poco a poco hasta liquidarlo 45 dÃ­as antes de la fecha del check in. Cualquier modificaciÃ³n o cancelaciÃ³n al paquete se puede realizar antes de la fecha lÃ­mite de pago.',
  california:'âœ… El paquete se aparta con $200 USD y el resto se puede ir pagando poco a poco hasta liquidarlo 1 mes antes de la fecha del check in. Cualquier modificaciÃ³n o cancelaciÃ³n al paquete se puede realizar antes de la fecha lÃ­mite de pago.',
  paris:'',
  'crucero-disney':'âœ… El apartado de cada camarote se hace realizando un pago por el 10% del total y el resto se puede ir pagando poco a poco hasta liquidarlo 3 meses antes de la fecha de embarque.\nğŸ›‚ El cliente se debe de hacer responsable de tener todos sus papeles en tiempo y forma para poder viajar. Favor de verificar que tengan su visa americana vigente y si es el caso, cualquier otro documento necesario para entrar al paÃ­s destino.',
  'crucero-otros':'âœ… El apartado de cada camarote se hace realizando un pago por el 20% del total y el resto se puede ir pagando poco a poco hasta liquidarlo 3 meses antes de la fecha de embarque.\nğŸ›‚ El cliente se debe de hacer responsable de tener todos sus papeles en tiempo y forma para poder viajar. Favor de verificar que tengan su visa americana vigente y si es el caso, cualquier otro documento necesario para entrar al paÃ­s destino.',
  nickelodeon:'Se puede apartar con $200 USD e irlo pagando poco a poco.',
  xcaret:'Se puede apartar con $200 USD e irlo pagando poco a poco.'
};

const INCLUSIONS_NICK=`*Tu tarifa incluye*\nğŸ” Alimentos\nğŸ¹ Bebidas\nğŸ½ Restaurantes temÃ¡ticos\nğŸ“¸ Encuentros con personajes\nğŸ¤ Entretenimiento todas las noches\nğŸŸ Entradas ilimitadas al parque acuÃ¡tico "AquaNick"\nğŸš— Transporte redondo del aeropuerto de CancÃºn al hotel`;
const INCLUSIONS_XCARET=`*Tu tarifa incluye*\nğŸ” Alimentos\nğŸ¹ Bebidas\nğŸ½ Restaurantes\nğŸ¤ Entretenimiento\nğŸŸ Entradas a todos los parques de Xcaret\nğŸ Actividades\nğŸš— Transporte redondo del aeropuerto de CancÃºn al hotel`;
const INCLUSIONS_CRUISE=`*ğŸŒŠ Tu tarifa incluye:*\n\nğŸ½ï¸ Comidas ilimitadas\nRestaurantes temÃ¡ticos y servicio a la habitaciÃ³n\nSnacks, cafeterÃ­as y helado 24/7\n\nğŸ¥¤Bebidas bÃ¡sicas\nSodas, CafÃ©, Jugo, TÃ©\n\nğŸ­ Entretenimiento diario\nShows estilo Broadway\nCine a bordo (pelÃ­culas Disney, Marvel, Pixar, Star Wars)\nFiestas en cubierta y fuegos artificiales\n\nğŸ‘¸ Encuentros con personajes\nPrincesas, Mickey y sus amigos, Marvel y mÃ¡s\n\nğŸŠ DiversiÃ³n en el agua\nToboganes, piscinas para niÃ±os, familias y adultos\nSplash zones y AquaDuck (en barcos selectos)\n\nğŸ¨ Clubes infantiles y juveniles\nActividades guiadas por edades (niÃ±os, tweens y teens)\nPersonal capacitado y espacios mÃ¡gicos\n\nğŸ¥‚ Zonas solo para adultos\nPiscina, jacuzzis, bares, discoteca, spa y restaurantes exclusivos\n\nğŸï¸ Paradas en islas privadas\nCastaway Cay o Lookout Cay at Lighthouse Point\nTodo incluido en la isla: comida, actividades y playa\n\nğŸ’« Magia y servicio Disney en todo momento\nAtenciÃ³n de lujo, limpieza impecable y detalles encantadores`;

const HOTEL_CATS={"Disney's All-Star Movies Resort":{cat:'Value',c:'cat-value'},"Disney's All-Star Music Resort":{cat:'Value',c:'cat-value'},"Disney's All-Star Sports Resort":{cat:'Value',c:'cat-value'},"Disney's Art of Animation Resort":{cat:'Value',c:'cat-value'},"Disney's Pop Century Resort":{cat:'Value',c:'cat-value'},"Disney's Caribbean Beach Resort":{cat:'Moderate',c:'cat-moderate'},"Disney's Coronado Springs Resort":{cat:'Moderate',c:'cat-moderate'},"Disney's Port Orleans - French Quarter":{cat:'Moderate',c:'cat-moderate'},"Disney's Port Orleans - Riverside":{cat:'Moderate',c:'cat-moderate'},"Disney's Fort Wilderness Cabins":{cat:'Moderate',c:'cat-moderate'},"Disney's Grand Floridian Resort & Spa":{cat:'Deluxe',c:'cat-deluxe'},"Disney's Contemporary Resort":{cat:'Deluxe',c:'cat-deluxe'},"Disney's Polynesian Village Resort":{cat:'Deluxe',c:'cat-deluxe'},"Disney's Animal Kingdom Lodge":{cat:'Deluxe',c:'cat-deluxe'},"Disney's Wilderness Lodge":{cat:'Deluxe',c:'cat-deluxe'},"Disney's BoardWalk Inn":{cat:'Deluxe',c:'cat-deluxe'},"Disney's Beach Club Resort":{cat:'Deluxe',c:'cat-deluxe'},"Disney's Yacht Club Resort":{cat:'Deluxe',c:'cat-deluxe'},"Disney's Riviera Resort":{cat:'Deluxe',c:'cat-deluxe'},"Walt Disney World Swan":{cat:'On-site',c:'cat-onsite'},"Walt Disney World Dolphin":{cat:'On-site',c:'cat-onsite'},"Four Seasons Resort Orlando":{cat:'Premier',c:'cat-premier'},"Universal's Endless Summer - Surfside Inn":{cat:'Value',c:'cat-value'},"Universal's Endless Summer - Dockside Inn":{cat:'Value',c:'cat-value'},"Universal's Cabana Bay Beach Resort":{cat:'Prime Value',c:'cat-prime'},"Universal's Aventura Hotel":{cat:'Prime Value',c:'cat-prime'},"Universal Stella Nova Resort":{cat:'Prime Value',c:'cat-prime'},"Universal Terra Luna Resort":{cat:'Prime Value',c:'cat-prime'},"Loews Sapphire Falls Resort":{cat:'Preferred',c:'cat-preferred'},"Loews Royal Pacific Resort":{cat:'Preferred',c:'cat-preferred'},"Hard Rock Hotel Orlando":{cat:'Preferred',c:'cat-preferred'},"Loews Portofino Bay Hotel":{cat:'Preferred',c:'cat-preferred'},"Universal's Grand Helios Hotel":{cat:'Preferred',c:'cat-preferred'},"Disneyland Hotel":{cat:'Disney',c:'cat-disney'},"Disney's Grand Californian Hotel & Spa":{cat:'Disney',c:'cat-disney'},"Pixar Place Hotel":{cat:'Disney',c:'cat-disney'},"Disney's Hotel New York â€“ The Art of Marvel":{cat:'Deluxe',c:'cat-deluxe'},"Disney Newport Bay Club":{cat:'Premium',c:'cat-moderate'},"Disney Sequoia Lodge":{cat:'Premium',c:'cat-moderate'},"Disney Hotel Cheyenne":{cat:'EstÃ¡ndar',c:'cat-value'},"Disney Hotel Santa Fe":{cat:'EstÃ¡ndar',c:'cat-value'},"Hotel Xcaret MÃ©xico":{cat:'5 Diamantes',c:'cat-deluxe'},"Hotel Xcaret Arte":{cat:'5 Diamantes',c:'cat-premier'},"La Casa de la Playa":{cat:'Adults Only',c:'cat-preferred'}};

const DEST_IMAGES={orlando:'https://images.unsplash.com/photo-1597466599360-3b9775841aec?w=800&h=400&fit=crop&q=80',universal:'https://images.unsplash.com/photo-1581084324659-bc65fa92df5c?w=800&h=400&fit=crop&q=80',california:'https://images.unsplash.com/photo-1587162146766-e06b1189b907?w=800&h=400&fit=crop&q=80',paris:'https://images.unsplash.com/photo-1595577248023-3ecf7637d6bb?w=800&h=400&fit=crop&q=80','crucero-disney':'https://images.unsplash.com/photo-1548574505-5e239809ee19?w=800&h=400&fit=crop&q=80','crucero-otros':'https://images.unsplash.com/photo-1599640842225-85d111c60e6b?w=800&h=400&fit=crop&q=80',nickelodeon:'https://images.unsplash.com/photo-1582719508461-905c673771fd?w=800&h=400&fit=crop&q=80',xcaret:'https://images.unsplash.com/photo-1552074284-5e88ef1aef18?w=800&h=400&fit=crop&q=80'};
const DEST_GRADIENTS={orlando:'linear-gradient(135deg,#1a1a6e,#4b2583,#c33f91)',universal:'linear-gradient(135deg,#003366,#0066cc,#00ccff)',california:'linear-gradient(135deg,#ff6b35,#ff9a56,#ffd700)',paris:'linear-gradient(135deg,#2d1b69,#5b3a8c,#e8716d)','crucero-disney':'linear-gradient(135deg,#001a33,#003d66,#0099cc)','crucero-otros':'linear-gradient(135deg,#1a3a4a,#2d6b7a,#4fc3c3)',nickelodeon:'linear-gradient(135deg,#ff6600,#ff9900,#33cc33)',xcaret:'linear-gradient(135deg,#004d40,#00897b,#4dd0e1)'};

const SHIP_DATA={'Disney Magic':{y:'1998',d:'El barco original Â· Rutas clÃ¡sicas'},'Disney Wonder':{y:'1999',d:'Alaska y Caribe Â· Frozen Musical'},'Disney Dream':{y:'2011',d:'AquaDuck Â· Caribe y Bahamas'},'Disney Fantasy':{y:'2012',d:'AquaDuck Â· Caribe occidental'},'Disney Wish':{y:'2022',d:'AquaMouse Â· Gran Hall Â· Lo mÃ¡s nuevo'},'Disney Treasure':{y:'2024',d:'Aventura y exploraciÃ³n Â· Ãšltimo barco'}};

const UNI_TICKET_DESC={'3base':'Visita 1 parque por dÃ­a a elegir entre Universal Studios Florida, Islands of Adventure o Epic Universe.','3ptp':'Acceso ilimitado a Universal Studios, Islands of Adventure y Epic Universe todos los dÃ­as. Puedes saltar entre parques.','4ptp':'4 dÃ­as de acceso ilimitado park-to-park a los 3 parques. OpciÃ³n de agregar Volcano Bay.','5ptp':'5 dÃ­as de acceso ilimitado park-to-park a los 3 parques incluyendo Epic Universe.'};

let itCounts={crd:0,cro:0},pgCount=0;

// â”€â”€ UTILS â”€â”€
function formatDate(s){if(!s)return'';const m=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];const[y,mo,d]=s.split('-');return`${+d} de ${m[+mo-1]} ${y}`}
function formatDateShort(s){if(!s)return'';const m=['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];const[y,mo,d]=s.split('-');return`${+d} ${m[+mo-1]} ${y}`}
function getMinorsText(){const a=+$('#menores02').value||0,b=+$('#menores39').value||0,c=+$('#menores1017').value||0,t=a+b+c;if(!t)return'';let p=[];if(a)p.push('(0-2 aÃ±os)');if(b)p.push('(3-9 aÃ±os)');if(c)p.push('(10-17 aÃ±os)');return`${t} ${p.join(' ')}`}
function getMinorsCardText(){const a=+$('#menores02').value||0,b=+$('#menores39').value||0,c=+$('#menores1017').value||0,t=a+b+c;if(!t)return'';let d=[];if(a)d.push(`${a} de 0-2`);if(b)d.push(`${b} de 3-9`);if(c)d.push(`${c} de 10-17`);return`${t} Menor${t>1?'es':''} (${d.join(', ')})`}
function getMinorsTotal(){return(+$('#menores02').value||0)+(+$('#menores39').value||0)+(+$('#menores1017').value||0)}
function $(sel){return document.querySelector(sel)}
function $$(sel){return document.querySelectorAll(sel)}
function v(id){return document.getElementById(id)?.value?.trim()||''}
function ck(id){return document.getElementById(id)?.checked||false}
function showToast(t){const el=$('#toast');el.textContent=t;el.classList.remove('opacity-0','pointer-events-none');setTimeout(()=>el.classList.add('opacity-0','pointer-events-none'),2000)}

// â”€â”€ HOTEL/SHIP PREVIEW â”€â”€
function showHotelPreview(pfx){const sel=document.getElementById(`${pfx}-hotel`),prev=document.getElementById(`${pfx}-hotel-preview`),h=sel.value;if(!h){prev.innerHTML='';return}const d=HOTEL_CATS[h];if(!d){prev.innerHTML='';return}prev.innerHTML=`<div style="background:#FFF8F0;border:1.5px solid #FFE8CC;border-radius:14px;padding:12px;display:flex;align-items:center;gap:10px"><span class="hotel-cat ${d.c}">${d.cat}</span><span style="font-size:13px;font-weight:500;color:#1B2A4A">${h}</span></div>`}
function showShipPreview(){const b=v('crd-barco'),d=SHIP_DATA[b],prev=$('#crd-ship-preview');if(!d){prev.innerHTML='';return}prev.innerHTML=`<div style="background:linear-gradient(135deg,#1B2A4A,#2C4570);border-radius:14px;padding:16px;color:#fff"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><span style="font-size:15px;font-weight:700">ğŸš¢ ${b}</span><span style="font-size:11px;opacity:.6">${d.y}</span></div><div style="font-size:12px;opacity:.8">${d.d}</div></div>`}

// â”€â”€ UNIVERSAL TICKET DESC â”€â”€
function updateUniDesc(){const t=v('uni-modalidad'),desc=UNI_TICKET_DESC[t]||'';$('#uni-desc').innerHTML=desc?`<p>â„¹ï¸ ${desc}</p>`:'';}

// â”€â”€ DINING PLAN â”€â”€
function toggleComidaDetail(){const plan=v('orl-comidas'),det=$('#orl-comidas-detail'),info=$('#orl-comidas-info');if(!plan){det.style.display='none';return}det.style.display='';if(plan==='quick')info.innerHTML='<b>Quick-Service:</b> 2 comidas rÃ¡pidas + 1 snack + mug recargable por persona por noche ($60.50 USD/adulto)';else info.innerHTML='<b>Standard:</b> 1 comida de mesa + 1 rÃ¡pida + 1 snack + mug recargable por persona por noche ($98.50 USD/adulto)'}

// â”€â”€ FORM MANAGEMENT â”€â”€
function onDestinoChange(){const d=v('destino'),c=$('#form-container');if(!d){c.style.display='none';$('#dest-image-preview').style.display='none';return}c.style.display='';const img=$('#dest-image'),imgC=$('#dest-image-preview');if(DEST_IMAGES[d]){img.src=DEST_IMAGES[d];imgC.style.display=''}else{imgC.style.display='none'}$$('.dest-section').forEach(el=>el.classList.remove('active'));const map={orlando:'campos-orlando',universal:'campos-universal',california:'campos-california',paris:'campos-paris','crucero-disney':'campos-crucero-disney','crucero-otros':'campos-crucero-otros',nickelodeon:'campos-nickelodeon',xcaret:'campos-xcaret'};if(map[d])document.getElementById(map[d]).classList.add('active');const cr=d.startsWith('crucero');$('#label-habitaciones').textContent=cr?'Camarotes':'Habitaciones';$('#label-checkin').textContent=cr?'Embarque':'Check in';$('#label-checkout').textContent=cr?'Desembarque':'Check out';$('#price-section').style.display=d==='crucero-otros'?'none':'';if(d==='crucero-disney'&&!itCounts.crd){for(let i=0;i<5;i++)addItineraryDay('crd');showShipPreview()}if(d==='crucero-otros'&&!itCounts.cro){for(let i=0;i<5;i++)addItineraryDay('cro');if(!pgCount)addPriceGroup()}if(d==='universal')updateUniDesc();$('#preview-section')&&($('#preview-section').style.display='none')}

// â”€â”€ ITINERARY â”€â”€
function addItineraryDay(p){itCounts[p]++;const n=itCounts[p],c=document.getElementById(`${p}-itinerario-container`),r=document.createElement('div');r.className='it-row';r.id=`${p}-d-${n}`;r.innerHTML=`<span style="font-size:11px;font-weight:600;color:#999;width:44px;flex-shrink:0">DÃ­a ${n}</span><input type="text" placeholder="Puerto CaÃ±averal, Florida" class="fi-input" style="flex:1;padding:10px 14px;font-size:13px" id="${p}-d-${n}-v"><button type="button" onclick="document.getElementById('${p}-d-${n}').remove()" style="color:#E8716D;font-size:18px;font-weight:700;width:32px;height:32px;border:none;background:none;cursor:pointer">Ã—</button>`;c.appendChild(r)}
function getItinerary(p){const rows=document.getElementById(`${p}-itinerario-container`).querySelectorAll('.it-row');let lines=[],n=1;rows.forEach(r=>{const i=r.querySelector('input');if(i&&i.value.trim()){lines.push(`âƒ\tDÃ­a ${n}: ${i.value.trim()}`);n++}});return lines.join('\n')}

// â”€â”€ PRICE GROUPS â”€â”€
function addPriceGroup(){pgCount++;const n=pgCount,c=$('#cro-precios-container'),d=document.createElement('div');d.className='price-group-card';d.id=`pg-${n}`;d.innerHTML=`<div style="display:flex;gap:8px;margin-bottom:10px"><input type="text" placeholder="Ej: 2 Adultos 1 Menor (8 aÃ±os)" class="fi-input" style="flex:1;padding:10px 14px;font-size:13px" id="pg-${n}-d"><button type="button" onclick="document.getElementById('pg-${n}').remove()" style="color:#E8716D;font-size:18px;font-weight:700;border:none;background:none;cursor:pointer">Ã—</button></div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px"><div><label style="font-size:10px;color:#999">Interior</label><input type="text" placeholder="$" class="fi-input" style="padding:8px 10px;font-size:12px" id="pg-${n}-i"></div><div><label style="font-size:10px;color:#999">Vista al mar</label><input type="text" placeholder="$" class="fi-input" style="padding:8px 10px;font-size:12px" id="pg-${n}-v"></div><div><label style="font-size:10px;color:#999">BalcÃ³n</label><input type="text" placeholder="$" class="fi-input" style="padding:8px 10px;font-size:12px" id="pg-${n}-b"></div></div>`;c.appendChild(d)}
function getPriceGroups(){const gs=$('#cro-precios-container').querySelectorAll('.price-group-card');let t='';gs.forEach(g=>{const id=g.id,desc=g.querySelector(`#${id}-d`)?.value?.trim()||'',i=g.querySelector(`#${id}-i`)?.value?.trim()||'',vi=g.querySelector(`#${id}-v`)?.value?.trim()||'',b=g.querySelector(`#${id}-b`)?.value?.trim()||'';if(desc){t+=`\nğŸ’¸Precios para ${desc}\n`;if(i)t+=`- Camarote interior: Desde $${i} USD\n`;if(vi)t+=`- Camarote con vista al mar: Desde $${vi} USD\n`;if(b)t+=`- Camarote con balcÃ³n: Desde $${b} USD\n`}});return t.trim()}

// â”€â”€ MESSAGE BUILDERS â”€â”€
function greet(d){const n=v('nombre'),t=AGENT_TITLES[d]||'Agente de viajes';return`${n?'Hola '+n+'!':'Hola!'} CÃ³mo estÃ¡s?\nSoy Mich Murrieta, ${t}\n\nTe comparto tu cotizaciÃ³n, avÃ­same cÃ³mo la ves y si gustas que hagamos alguna modificaciÃ³n o tienes alguna duda â¬‡ï¸`}
function travelers(){const a=v('adultos'),m=getMinorsText();let t=`\n*Adultos:* ${a}`;if(m)t+=`\n*Menores:* ${m}`;return t}
function closing(){return'Cualquier duda estoy a tus Ã³rdenes âœ¨'}

function genOrlando(){const h=v('orl-hotel'),mod=v('orl-modalidad'),dias=v('orl-dias'),p=v('precio'),plan=v('orl-comidas'),kf=ck('orl-kidsfree'),mm=ck('orl-memory');let m=greet('orlando')+'\n'+travelers();if(h)m+=`\n*Hospedaje:* ${h}`;m+=`\n\nCheck in: ${formatDate(v('checkin'))}\nCheck out: ${formatDate(v('checkout'))}`;const modText=mod.includes('Base')?'1 parque x dÃ­a':mod;m+=`\n\nğŸŸ Entradas a los parques con modalidad "${modText}" vÃ¡lido por ${dias} dÃ­as`;if(plan==='quick')m+=`\nğŸ” Plan de comidas Quick-Service (2 comidas rÃ¡pidas + 1 snack x persona x noche)`;else if(plan==='standard')m+=`\nğŸ½ Plan de comidas Standard (1 mesa + 1 rÃ¡pida + 1 snack x persona x noche)`;if(kf)m+=`\nğŸ‰ *PromociÃ³n Kids Eat Free 2026* - NiÃ±os de 3 a 9 aÃ±os comen gratis con plan de comidas de adulto`;m+=`\n\n*ğŸ’¸$${p} USD*`;if(mm)m+=`\n\nğŸ“¸Agrega el paquete de fotos "Memory Maker" por *$185 USD* adicionales`;m+=`\n\n${CONDITIONS.orlando}`;const n=v('notas');if(n)m+=`\n\n${n}`;m+=`\n\n${closing()}`;return m}

function genUniversal(){const h=v('uni-hotel'),ticket=v('uni-modalidad'),dias=v('uni-dias'),p=v('precio'),vol=ck('uni-volcano');const ticketNames={'3base':'Base (1 parque por dÃ­a)','3ptp':'Park-to-Park','4ptp':'Park-to-Park','5ptp':'Park-to-Park'};let m=greet('universal')+'\n'+travelers();if(h)m+=`\n\nHospedaje: ${h}`;m+=`\n\nCheck in: ${formatDate(v('checkin'))}\nCheck out: ${formatDate(v('checkout'))}`;m+=`\n\nğŸŸ Entradas con modalidad "${ticketNames[ticket]||ticket}" vÃ¡lido por ${dias} dÃ­as`;m+=`\n que te permite entrar a:\nâ€¢â   â Universal Studios Florida\nâ€¢â   â Islands of Adventure\nâ€¢â   â Universal Epic Universe`;if(vol)m+=`\nâ€¢â   â Volcano Bay`;m+=`\n\nğŸ’¸ *$${p} USD*\n\n${CONDITIONS.universal}`;const n=v('notas');if(n)m+=`\n\n${n}`;m+=`\n\n${closing()}`;return m}

function genCalifornia(){const h=v('cal-hotel'),ticket=v('cal-ticket'),dias=v('cal-dias'),ll=v('cal-lightning'),p=v('precio'),sw=ck('cal-starwars');let m=greet('california')+'\n'+travelers();if(h)m+=`\n*Hospedaje:* ${h}`;m+=`\n\nCheck in: ${formatDate(v('checkin'))}\nCheck out: ${formatDate(v('checkout'))}`;m+=`\n\nğŸŸ Entradas a los parques con modalidad "${ticket}" vÃ¡lido por ${dias} dÃ­as`;if(ll==='multi')m+=`\nâš¡ Lightning Lane Multi Pass incluido`;else if(ll==='single')m+=`\nâš¡ Lightning Lane Single Pass (atracciones selectas)`;else if(ll==='premier')m+=`\nâš¡ Lightning Lane Premier Pass (todas las atracciones, sin ventana de horario)`;m+=`\n\n*ğŸ’¸$${p} USD*\n\n${CONDITIONS.california}`;if(sw)m+=`\n\n*STAR WARS NITEğŸª* La entrada a este evento es adicional y costarÃ­a aproximadamente $200 USD x persona. AÃºn no tenemos los precios, pero yo les avisarÃ­a en cuanto estÃ©n disponibles`;const n=v('notas');if(n)m+=`\n\n${n}`;m+=`\n\n${closing()}`;return m}

function genParis(){const h=v('par-hotel'),p=v('precio');let m=greet('paris')+'\n'+travelers();if(h)m+=`\n*Hospedaje:* ${h}`;m+=`\n\nCheck in: ${formatDate(v('checkin'))}\nCheck out: ${formatDate(v('checkout'))}\n\nğŸŸ Entradas vÃ¡lidas por toda su estancia\nğŸ½ Desayuno incluido\n\n*ğŸ’¸$${p} USD*`;const n=v('notas');if(n)m+=`\n\n${n}`;m+=`\n\n${closing()}`;return m}

function genCruceroDisney(){const b=v('crd-barco'),cam=v('crd-camarote').toLowerCase(),p=v('precio'),promo=v('crd-promo'),it=getItinerary('crd');let m=greet('crucero-disney')+'\n'+travelers();m+=`\n\nğŸ›³Barco: *${b}*`;if(it)m+=`\n\nğŸ“Itinerario\n${it}`;m+=`\n\nğŸ—“*Fechas*\n${formatDate(v('checkin'))} al ${formatDate(v('checkout'))}\n\nğŸ’¸Precios\nâ€¢ Camarote con ${cam}: *Desde $${p} USD*`;if(promo)m+=`\n\n*PROMOCIÃ“N: ${promo}âœ¨ğŸ¤©*`;m+=`\n\n${CONDITIONS['crucero-disney']}\n\n${INCLUSIONS_CRUISE}`;const n=v('notas');if(n)m+=`\n\n${n}`;m+=`\n\n${closing()}`;return m}

function genCruceroOtros(){const b=v('cro-barco'),it=getItinerary('cro'),pg=getPriceGroups();let m=greet('crucero-otros')+'\n'+travelers();if(b)m+=`\n\nğŸ›³Barco: ${b}`;if(it)m+=`\n\nğŸ“Itinerario\n${it}`;m+=`\n\nğŸ—“Fechas\n${formatDate(v('checkin'))} al ${formatDate(v('checkout'))}`;if(pg)m+=`\n\n${pg}`;m+=`\n\n${CONDITIONS['crucero-otros']}`;const n=v('notas');if(n)m+=`\n\n${n}`;m+=`\n\n${closing()}`;return m}

function genNickelodeon(){const p=v('precio');let m=greet('nickelodeon')+'\n'+travelers();m+=`\n*Hospedaje:* Nickelodeon Resort - Riviera Maya - TODO INCLUIDO\n\nCheck in: ${formatDate(v('checkin'))}\nCheck out: ${formatDate(v('checkout'))}\n\n*ğŸ’¸$${p} USD*\n${CONDITIONS.nickelodeon}\n\n${INCLUSIONS_NICK}`;const n=v('notas');if(n)m+=`\n\n${n}`;m+=`\n\n${closing()}`;return m}

function genXcaret(){const h=v('xca-hotel'),p=v('precio');let m=greet('xcaret')+'\n'+travelers();m+=`\n*Hospedaje:* ${h}\n\nCheck in: ${formatDate(v('checkin'))}\nCheck out: ${formatDate(v('checkout'))}\n\n*ğŸ’¸$${p} USD*\n${CONDITIONS.xcaret}\n\n${INCLUSIONS_XCARET}`;const n=v('notas');if(n)m+=`\n\n${n}`;m+=`\n\n${closing()}`;return m}

// â”€â”€ WHATSAPP PREVIEW (formatted) â”€â”€
function textToWAHtml(text){return text.replace(/\*(.*?)\*/g,'<b>$1</b>').replace(/\n/g,'<br>')}
function waHtmlToText(el){let t=el.innerHTML;t=t.replace(/<b>(.*?)<\/b>/gi,'*$1*');t=t.replace(/<br\s*\/?>/gi,'\n');t=t.replace(/<div>/gi,'\n');t=t.replace(/<\/div>/gi,'');t=t.replace(/&amp;/g,'&');t=t.replace(/&lt;/g,'<');t=t.replace(/&gt;/g,'>');t=t.replace(/&nbsp;/g,' ');return t}

// â”€â”€ MAIN GENERATE â”€â”€
function generarMensaje(){const d=v('destino');if(!d)return;const gens={orlando:genOrlando,universal:genUniversal,california:genCalifornia,paris:genParis,'crucero-disney':genCruceroDisney,'crucero-otros':genCruceroOtros,nickelodeon:genNickelodeon,xcaret:genXcaret};const msg=gens[d]();$('#wa-preview').innerHTML=textToWAHtml(msg);generateCard(d);$('#preview-section').style.display='';switchTab('texto');$('#preview-section').scrollIntoView({behavior:'smooth',block:'start'})}

// â”€â”€ CARD GENERATION â”€â”€
function generateCard(dest){const nombre=v('nombre')||'Cliente',adultos=v('adultos'),minors=getMinorsCardText(),checkin=v('checkin'),checkout=v('checkout'),precio=v('precio');const names={orlando:'ğŸ° Disney World Â· Orlando',universal:'ğŸ¢ Universal Studios Â· Orlando',california:'ğŸ¡ Disneyland Â· California',paris:'ğŸ—¼ Disneyland Â· Paris','crucero-disney':'ğŸš¢ Crucero Disney','crucero-otros':'ğŸ›³ Crucero',nickelodeon:'ğŸ§½ Nickelodeon Resort',xcaret:'ğŸŒ´ Xcaret'};
let details='';
if(dest==='orlando'){const h=v('orl-hotel');if(h)details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸ¨</span><span class="card-editable-dark" contenteditable="true">${h}</span></div>`;details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸŸ</span><span>${v('orl-modalidad')} Â· ${v('orl-dias')} dÃ­as</span></div>`;if(v('orl-comidas'))details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸ½</span><span>Plan de comidas incluido</span></div>`;if(ck('orl-kidsfree'))details+=`<div style="display:flex;align-items:center;gap:8px;color:#22c55e;font-weight:600"><span>ğŸ‰</span><span>Kids Eat Free 2026</span></div>`}
else if(dest==='universal'){const h=v('uni-hotel');if(h)details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸ¨</span><span class="card-editable-dark" contenteditable="true">${h}</span></div>`;details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸŸ</span><span>Epic Universe + Universal + Islands</span></div>`;if(ck('uni-volcano'))details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸŒ‹</span><span>Volcano Bay incluido</span></div>`}
else if(dest==='california'){const h=v('cal-hotel');if(h)details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸ¨</span><span class="card-editable-dark" contenteditable="true">${h}</span></div>`;details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸŸ</span><span>${v('cal-ticket')} Â· ${v('cal-dias')} dÃ­as</span></div>`;const ll=v('cal-lightning');if(ll)details+=`<div style="display:flex;align-items:center;gap:8px"><span>âš¡</span><span>Lightning Lane</span></div>`}
else if(dest==='paris'){const h=v('par-hotel');if(h)details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸ¨</span><span class="card-editable-dark" contenteditable="true">${h}</span></div>`;details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸŸ</span><span>Entradas toda la estancia</span></div><div style="display:flex;align-items:center;gap:8px"><span>ğŸ½</span><span>Desayuno incluido</span></div>`}
else if(dest==='crucero-disney'){details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸš¢</span><span class="card-editable-dark" contenteditable="true">${v('crd-barco')}</span></div><div style="display:flex;align-items:center;gap:8px"><span>ğŸ›</span><span>Camarote ${v('crd-camarote').toLowerCase()}</span></div>`;if(v('crd-promo'))details+=`<div style="display:flex;align-items:center;gap:8px;color:#E8716D;font-weight:600"><span>ğŸ‰</span><span class="card-editable-dark" contenteditable="true">${v('crd-promo')}</span></div>`}
else if(dest==='crucero-otros'){if(v('cro-barco'))details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸš¢</span><span class="card-editable-dark" contenteditable="true">${v('cro-barco')}</span></div>`}
else if(dest==='nickelodeon'){details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸ¨</span><span>Nickelodeon Resort Â· Riviera Maya</span></div><div style="display:flex;align-items:center;gap:8px"><span>âœ…</span><span>TODO INCLUIDO</span></div>`}
else if(dest==='xcaret'){details+=`<div style="display:flex;align-items:center;gap:8px"><span>ğŸ¨</span><span class="card-editable-dark" contenteditable="true">${v('xca-hotel')}</span></div><div style="display:flex;align-items:center;gap:8px"><span>âœ…</span><span>TODO INCLUIDO</span></div>`}

const isCr=dest.startsWith('crucero'),dateLabel=isCr?`${formatDate(checkin)} al ${formatDate(checkout)}`:`${formatDateShort(checkin)} â†’ ${formatDateShort(checkout)}`,hasPrice=dest!=='crucero-otros',grad=DEST_GRADIENTS[dest]||'linear-gradient(135deg,#E8716D,#D4605C)',imgUrl=DEST_IMAGES[dest]||'';
const condMap={orlando:'âœ… Aparta con $200 USD Â· Liquida 1 mes antes',california:'âœ… Aparta con $200 USD Â· Liquida 1 mes antes',universal:'âœ… Aparta con $50 USD/persona Â· Liquida 45 dÃ­as antes','crucero-disney':'âœ… Aparta con 10% Â· Liquida 3 meses antes','crucero-otros':'âœ… Aparta con 20% Â· Liquida 3 meses antes',nickelodeon:'âœ… Aparta con $200 USD',xcaret:'âœ… Aparta con $200 USD',paris:''};

$('#card-render').innerHTML=`<div style="width:100%;background:#fff;border-radius:20px;overflow:hidden;box-shadow:0 4px 30px rgba(0,0,0,.12);font-family:'Poppins',sans-serif">
<div style="position:relative;height:130px;background:${grad};overflow:hidden">${imgUrl?`<img src="${imgUrl}" style="width:100%;height:100%;object-fit:cover;opacity:.45" onerror="this.style.display='none'" crossorigin="anonymous">`:''}
<div style="position:absolute;inset:0;display:flex;flex-direction:column;justify-content:flex-end;padding:14px 20px;background:linear-gradient(to top,rgba(0,0,0,.55),transparent)">
<div style="font-size:17px;font-weight:800;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.3)">${names[dest]||dest}</div></div></div>
<div style="background:#1B2A4A;color:#fff;padding:9px 20px;display:flex;justify-content:space-between;align-items:center">
<div><span style="font-size:13px;font-weight:700">âœ¨ Mich Murrieta</span><span style="font-size:10px;opacity:.6;margin-left:8px">${AGENT_TITLES[dest]||''}</span></div></div>
<div style="padding:20px">
<div style="display:flex;gap:16px;margin-bottom:16px;padding-bottom:14px;border-bottom:1px solid #f0f0f0">
<div style="text-align:center;flex:1"><div style="font-size:22px">ğŸ‘¥</div><div style="font-size:12px;font-weight:600;color:#1B2A4A">${adultos} Adulto${+adultos!==1?'s':''}</div></div>
${getMinorsTotal()>0?`<div style="text-align:center;flex:1"><div style="font-size:22px">ğŸ‘¶</div><div style="font-size:11px;font-weight:600;color:#1B2A4A">${minors}</div></div>`:''}</div>
<div style="background:#FFF8F0;border-radius:12px;padding:10px 16px;margin-bottom:14px;text-align:center">
<div style="font-size:10px;color:#888;text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px">ğŸ“… Fechas</div>
<div style="font-size:13px;font-weight:600;color:#1B2A4A">${dateLabel}</div></div>
<div style="display:flex;flex-direction:column;gap:7px;margin-bottom:14px;font-size:12px;color:#333">${details}</div>
${hasPrice?`<div style="background:linear-gradient(135deg,#1B2A4A,#2C4570);border-radius:14px;padding:14px;text-align:center;margin-bottom:14px">
<div style="font-size:10px;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:1px;margin-bottom:3px">Precio total</div>
<div style="font-size:26px;font-weight:800;color:#fff">$<span class="card-editable" contenteditable="true">${precio}</span></div>
<div style="font-size:11px;color:rgba(255,255,255,.6)">USD</div></div>`:''}
<div style="font-size:10px;color:#888;line-height:1.5;margin-bottom:4px">${condMap[dest]||''}</div>
<div contenteditable="true" style="font-size:11px;color:#999;font-style:italic;min-height:16px;outline:none;border-bottom:1px dashed #eee;padding-bottom:4px" data-placeholder="+ Agregar nota aquÃ­..."></div>
</div>
<div style="background:#FFF8F0;padding:12px 20px;display:flex;justify-content:space-between;align-items:center;border-top:1px solid #f0e8dc">
<div><div style="font-size:11px;color:#1B2A4A;font-weight:600">ğŸ“² +52 55 1766 6721</div><div style="font-size:9px;color:#888">michmurrietaviajes.com</div></div>
<div style="font-size:9px;color:#888;text-align:right">ğŸ“¸ @michmurrieta_viajes</div></div></div>`}

// â”€â”€ TABS â”€â”€
function switchTab(t){$('#tab-texto').classList.toggle('active',t==='texto');$('#tab-tarjeta').classList.toggle('active',t==='tarjeta');$('#panel-texto').style.display=t==='texto'?'':'none';$('#panel-tarjeta').style.display=t==='tarjeta'?'':'none'}

// â”€â”€ ACTIONS â”€â”€
function copiarTexto(){const raw=waHtmlToText($('#wa-preview'));navigator.clipboard.writeText(raw).then(()=>showToast('Copiado al portapapeles âœ…'))}
function descargarImagen(){const card=$('#card-render');showToast('Generando imagen...');html2canvas(card,{scale:2,backgroundColor:null,useCORS:true,logging:false}).then(canvas=>{const a=document.createElement('a');a.download=`Cotizacion_${(v('nombre')||'cliente').replace(/\s+/g,'_')}_${v('destino')}.png`;a.href=canvas.toDataURL('image/png');a.click();showToast('Imagen descargada âœ…')})}
</script>
</body>
</html>
